$( document ).ready(function() {
	$('#vul-type').on('change', function(){
		var vul_type = $(this).val();
		if (vul_type == "application"){
			$('#host_row').hide();
			$('#port_section').hide();
			$('#vulnerability').attr('action', '/vulnerability/application/');
			$('#id_port').removeAttr('required');
			$.ajax({
	            url: '/fetch-application-urls/',
	            type: 'POST',
	            data: {
	                'vul_type': "application"
	                },
	            dataType: 'json',
	            success: function(data){
	            	$('#app-url-div').show();
	            	$('#id_application').prop('required','true');
	            	var app_url_dropdown = $("#id_application");
                    app_url_dropdown.empty();
                    app_url_dropdown.append($("<option></option>").attr("value", '')
                    	.text('Please Select'));
                    $.each(data, function(i, item) {
                        app_url_dropdown.append($("<option></option>")
                            .attr("value", data[i].id).text(data[i].url));
                    });		
	            }
        	});
		}
		else if(vul_type == ""){
			$('#app-url-div').hide();
	        $('#id_application').removeAttr('required');
		}
		else if(vul_type == "network"){
			$('#app-url-div').hide();
			$('#port_section').show();
			$('#host_row').show();
	        $('#id_application').removeAttr('required');
	        $('#id_port').prop('required','true');
	        $('#vulnerability').removeAttr('action');
		}
	});
	$("#vulnerability").on('submit', function(e) {
		var vul_type = $('#vul-type').val()
		if (vul_type == "network"){
			var hosts = $( '#host_array').val()
	        if (hosts.length === 0){
	        	e.preventDefault();
	        	$( "#host-error" ).show().fadeOut(3000);
	        	return;
	        }
		}
        
    });
});