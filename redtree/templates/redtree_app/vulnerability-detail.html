{% extends 'base.html' %}
{% load markup_tags %}
{% block title %}
	<title>Vulnerability - {{vulnerability.title}}</title>
{% endblock %}

{% block content %}
	<!-- Dashboard Wrapper Start -->
	<div class="dashboard-wrapper dashboard-wrapper-lg">
		<!-- Container fluid Starts -->
		<div class="container-fluid">
			{% if vulnerability %}
            <div class="top-bar clearfix vulnerability-width">
                <div class="row gutter">
                    <div class="col-lg-8 col-md-4 col-sm-4 col-xs-12">
                        <div class="page-title">
                            <h3>{{ vulnerability.title}}</h3>
                        </div>
                    </div>
					<div class="col-lg-4 col-md-2 col-sm-2 col-xs-12">
						<ul class="right-stats" id="mini-nav-right">
							<li>
								<button onclick="deleteVulnerability(this);" value="{{vulnerability.virtue_id}}" class="btn btn-danger">Delete</button>
							</li>
						</ul>
					</div>
                </div>
            </div>

			<!-- Row starts -->
			<div class="row gutter">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="panel vulnerability-width">
                        <div class="panel-heading">
                            <h3>Description</h3>
                        </div>
						<div class="panel-body">
							{% autoescape off %}
								<span class="markdown-css vul-space">
	                            	{{ vulnerability.formatted_description|safe }}
								</span>
							{% endautoescape %}
						</div>
					</div>
				</div>
			</div>
			<!-- Row ends -->
            <!-- Row starts -->
			<div class="row gutter">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="panel vulnerability-width">
                        <div class="panel-heading">
                            <h3>Remediation</h3>
                        </div>
						<div class="panel-body">
							{% autoescape off %}
								<span class="markdown-css vul-space">
 	                          		{{ vulnerability.formatted_remediation|safe }}
								</span>
							{% endautoescape %}
						</div>
					</div>
				</div>
			</div>
			<!-- Row ends -->
			<!-- Row starts -->
			{% if evidence_count >= 1 %}
				<div class="row gutter">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="panel vulnerability-width">
	                        <div class="panel-heading">
	                            <h3>Evidence</h3>
	                        </div>
							<div class="panel-body">
								{% if evidence_count == 1 %}
									{% for vulnerability in affected_hosts %}
										{% if vulnerability.evidence %}
											{% autoescape off %}
												<span class="markdown-css vul-space">
				 	                          		{{ vulnerability.formatted_evidence|safe }}
												</span>
											{% endautoescape %}
										{% endif %}
									{% endfor %}
								{% elif evidence_count > 1 %}
									<div class="table-responsive col-lg-12 col-md-12" >
										<table class="table-bordered table-hover table-condensed no-margin fixed" style="margin-top: -100px;">
										<thead>
											<tr>
												<th style="text-align: center;">Example Evidence</th>
											</tr>
										</thead>
										<tbody>
										{% for vulnerability in affected_hosts %}
										{% if vulnerability.evidence %}
										<tr>
											{% autoescape off %}
												<pre class="markdown-css vul-space">
													<th class="markdown-evidence-css">
				 	                          		{{ vulnerability.evidence|safe }}
				 	                          		</th>
				 	                          	</pre>
											{% endautoescape %}
										</tr>
										{% endif %}
										{% endfor %}
											</tbody>
										</table>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			{% endif %}
			<!-- Row ends -->
            <!-- Row starts -->
			<div class="row gutter">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="panel vulnerability-width">
                        <div class="panel-heading">
                            <h3>Affected Hosts</h3>
                        </div>
						<div class="panel-body">
                            <div class="table-responsive col-lg-12 col-md-12 custom-display">
								<table class="table-bordered table-hover table-condensed no-margin fixed" style="white-space: nowrap;">
									<thead>
										<tr>
											<th>Host</th>
											<th>Port</th>
											{% if banner %}
												<th>Banner</th>
											{% endif %}
											<th>Last Seen</th>
											<th>Created</th>
											<th>Detail</th>
											<th>Action</th>
										</tr>
									</thead>
									<tbody>
									{% for host in affected_hosts %}
										<tr>
											<td>
												<a href="/vulnerabilities/host/{{ host.host.id }}/">
													{{host.host_ip}}
												</a>
											</td>
											<td>{{host.port}}</td>
											{% if banner %}
												<td style="word-break: break-all;white-space: normal;">{{host.banner}}</td>
											{% endif %}
											<td>{{ host.modified|date:"M d, Y" }}</td>
											<td>
												{{host.created|date:"M d, Y" }}</td>
											<td><a href="/vulnerabilities/{{host.id}}/">view</a></td>
											<td>
												<a href="/vulnerabilities/edit/{{host.id}}/" class="btn btn-info btn-xs">Edit</a>
												<a href="/vulnerability-delete/{{host.id}}" class="btn btn-danger btn-xs">Delete</a>
											</td>
										</tr>
									{% endfor %}
									</tbody>
								</table>
								{% if affected_hosts.has_other_pages %}
								  	<ul class="pagination">
								    	{% if affected_hosts.has_previous %}
									      	<li>
									      		<a href="?page={{ affected_hosts.previous_page_number }}">
									      			&laquo;
									      		</a>
									      	</li>
								    	{% else %}
								      		<li class="disabled"><span>&laquo;</span></li>
								    	{% endif %}
								    	{% for i in affected_hosts.paginator.page_range %}
								      		{% if affected_hosts.number == i %}
								        		<li class="active">
								        			<span>
								        				{{ i }}
								        				<span class="sr-only">
								        					(current)
								        				</span>
								        			</span>
								        		</li>
								      		{% else %}
								        		<li><a href="?page={{ i }}">{{ i }}</a></li>
								      		{% endif %}
								    	{% endfor %}
								    	{% if affected_hosts.has_next %}
								      		<li>
								      			<a href="?page={{ affected_hosts.next_page_number }}">
								      				&raquo;
								      			</a>
								      		</li>
								    	{% else %}
								      		<li class="disabled"><span>&raquo;</span></li>
								    	{% endif %}
								  	</ul>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Row ends -->			
			{% else %}
			<p> No Vulnerabilities found</p>
			{% endif %}
		</div>
		<!-- Container fluid ends -->

	</div>
	<!-- Dashboard Wrapper End -->
{% endblock %}

{% block script %}
	<script src="/static/js/ipsdata.js"></script>
{% endblock %}