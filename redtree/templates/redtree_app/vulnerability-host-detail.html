{% extends 'base.html' %}
{% load markup_tags %}
{% block title %}
	<title>Vulnerability - {{vulnerability.title}}</title>
{% endblock %}
{% block extracss %}
    <link rel="stylesheet" href="/static/css/jquery.growl.css">    
{% endblock %}

{% block content %}
	<!-- Dashboard Wrapper Start -->
	<div class="dashboard-wrapper dashboard-wrapper-lg vul-universal-wd">
		{% if vulnerability %}
		<!-- Container fluid Starts -->
		<div class="container-fluid">

            <div class="top-bar clearfix">
                <div class="row gutter">
                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
                        <div class="page-title">
                            <ul class="text">
								<li>Vulnerabilitiess
									<span class="icon-chevron-right"></span>
										<a href="/vulnerabilities/host/{{vulnerability.host.id}}/" style="color: #ffffff">{{vulnerability.host_ip}}
										</a>
									<span class="icon-chevron-right"></span>
										{{ vulnerability.title}}
								</li>
							</ul>
                        </div>
                    </div>
                   	<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
						<ul class="right-stats" id="mini-nav-right">
							<li>
								<a href="/vulnerabilities/edit/{{vulnerability.id}}/"  class="btn btn-danger">Edit</a>
							</li>
							{% if vulnerability.retest.status == 'Closed' %}
							<li>
								<button type="button" class="btn btn-info">Closed</button>
							</li>
							{% else %}
							<li>
								<button type="button" class="btn btn-info" data-toggle="modal" data-target="#retestModal">Retest</button>
							</li>
							{% endif %}
							<li>
								<a href="/vulnerability-delete/{{vulnerability.id}}"  class="btn btn-danger">Delete</a>
							</li>
						</ul>
					</div>
                </div>
            </div>

			<!-- Row starts -->
			<div class="row gutter">
				<div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
					<div class="row gutter">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="panel">
		                        <div class="panel-heading">
		                            <h3>Description</h3>
		                        </div>
								<div class="panel-body">
									{% autoescape off %}
										<pre class="markdown-css">
				                            {{ vulnerability.formatted_description }}
				                        </pre>
									{% endautoescape %}
								</div>
							</div>
						</div>
					</div>
					<!-- Row ends -->
		            <!-- Row starts -->
					<div class="row gutter">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="panel">
		                        <div class="panel-heading">
		                            <h3>Remediation</h3>
		                        </div>
								<div class="panel-body">
		                            {% autoescape off %}
		                           		<pre class="markdown-css">
		 	                          		{{ vulnerability.formatted_remediation|safe }}
		 	                          	</pre>
									{% endautoescape %}
								</div>
							</div>
						</div>
					</div>
					{% if vulnerability.evidence %}
						<div class="row gutter">
							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
								<div class="panel">
			                        <div class="panel-heading">
			                            <h3>Evidence</h3>
			                        </div>
									<div class="panel-body">
			                           {% autoescape off %}
										<pre class="markdown-css">
											{{ vulnerability.formatted_evidence|safe }}
										</pre>
										{% endautoescape %}
									</div>
								</div>
							</div>
						</div>	
					{% endif %}
					<!-- Row ends -->
		            <!-- Row starts -->
					<div class="row gutter">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="panel">
		                        <div class="panel-heading">
		                            <h3>Affected Hosts</h3>
		                        </div>
								<div class="panel-body">
		                            <div class="table-responsive col-lg-8 col-md-8">
										<table class="table-bordered table-hover table-condensed no-margin">
											<thead>
												<tr>
													<th>Host</th>
													<th>Port</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>
														{{vulnerability.host_ip}}
													</td>
													<td>{{vulnerability.port}}</td>
												</tr>
											</tbody>

										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Row ends -->
					<!-- Modal -->
					<div id="retestModal" class="modal fade" role="dialog">
						<div class="modal-dialog">
							<!-- Modal content -->
							<div class="modal-content">
								<div class="modal-header">
									<h4 class="modal-title">Retest Note</h4>
								</div>
								<form  method="post">
									{% csrf_token %}
									<div class="modal-body">
										{{ form }}
									</div>
									<div class="modal-footer">
										<button type="button" name="cancel" value="cancel" class="btn btn-default retest-cancel-btn" data-dismiss="modal">Cancel</button>
										<button type="submit" name="leave" value="leave" class="btn btn-info">Leave Open</button>
										<button type="submit" name="close" value="close" class="btn btn-danger">Close</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-3 col-xs-">
					{% if vulnerability.retest_note %}
						<div class="row gutter">
							<div class="panel">
								<div class="panel-heading">
									<h3>Retest Note</h3>
								</div>
								{% for note in vulnerability.retest_note %}
								<div class="panel-body retest-border">
									<label class="retest-note-margin">
										{{note.created}}
									</label>
									<br>
									<label class="retest-note-margin">
										{{note.note}}
									</label>
								</div>
								<br>
								{% endfor %}
							</div>
						</div>
					{% endif %}
				</div>
			</div>
		<!-- Container fluid ends -->
		</div>
		{% else %}
		<h2>No record found.</h2>
		{% endif %}
	</div>
	<!-- Dashboard Wrapper End -->
{% endblock %}

{% block script %}
	<script src="/static/js/ipsdata.js"></script>
{% endblock %}